# إعداد Firebase - نظام إدارة المدارس

## 🔥 إعداد Firebase Console

### 1. إنشاء مشروع Firebase
1. اذهب إلى [Firebase Console](https://console.firebase.google.com/)
2. اضغط "Create a project"
3. أدخل اسم المشروع: `school-management-system`
4. فعّل Google Analytics (اختياري)
5. اضغط "Create project"

### 2. إضافة تطبيق ويب
1. في لوحة التحكم، اضغط على أيقونة الويب `</>`
2. أدخل اسم التطبيق: `admin-dashboard`
3. فعّل "Also set up Firebase Hosting" (اختياري)
4. اضغط "Register app"
5. انسخ كود التكوين

### 3. إعداد Firestore Database
1. في القائمة الجانبية، اضغط "Firestore Database"
2. اضغط "Create database"
3. اختر "Start in test mode" (للاختبار)
4. اختر موقع قاعدة البيانات (الأقرب لك)
5. اضغط "Done"

### 4. إعداد Authentication
1. في القائمة الجانبية، اضغط "Authentication"
2. اضغط "Get started"
3. اذهب إلى تبويب "Sign-in method"
4. فعّل "Email/Password"
5. اضغط "Save"

## 📁 تحديث ملفات التكوين

### 1. تحديث firebase_options.dart
استبدل محتوى `lib/firebase_options.dart` بالكود الذي حصلت عليه من Firebase Console:

```dart
// File generated by FlutterFire CLI.
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    // ... باقي الكود
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'YOUR_WEB_API_KEY', // ضع المفتاح هنا
    appId: 'YOUR_WEB_APP_ID',   // ضع معرف التطبيق هنا
    messagingSenderId: 'YOUR_MESSAGING_SENDER_ID',
    projectId: 'YOUR_PROJECT_ID', // ضع معرف المشروع هنا
    authDomain: 'YOUR_PROJECT_ID.firebaseapp.com',
    storageBucket: 'YOUR_PROJECT_ID.appspot.com',
  );
}
```

### 2. إعداد قواعد الأمان في Firestore

اذهب إلى Firestore Database > Rules واستبدل القواعد بـ:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // قواعد للمدارس
    match /schools/{schoolId} {
      allow read, write: if true; // للاختبار فقط
    }
    
    // قواعد للفصول
    match /class_sections/{classId} {
      allow read, write: if true; // للاختبار فقط
    }
    
    // قواعد للطلاب
    match /students/{studentId} {
      allow read, write: if true; // للاختبار فقط
    }
    
    // قواعد للمنسوبين
    match /staff/{staffId} {
      allow read, write: if true; // للاختبار فقط
    }
  }
}
```

**⚠️ تحذير:** هذه القواعد للاختبار فقط. في الإنتاج، يجب استخدام قواعد أمان أكثر صرامة.

## 🧪 اختبار النظام

### 1. تشغيل التطبيق
```bash
cd admin_dashboard
flutter run -d chrome
```

### 2. اختبار العمليات
1. **إنشاء مدرسة جديدة:**
   - سجل دخول كمسؤول شركة (`admin` / `admin123`)
   - اضغط "+" لإضافة مدرسة
   - املأ البيانات واحفظ

2. **إدارة المدرسة:**
   - سجل دخول كمسؤول مدرسة
   - أضف فصول جديدة
   - أضف طلاب (يدوياً أو عبر Excel)
   - أضف منسوبين

3. **التحقق من البيانات:**
   - اذهب إلى Firebase Console
   - تحقق من Firestore Database
   - يجب أن ترى المجموعات: `schools`, `class_sections`, `students`, `staff`

## 📊 هيكل البيانات في Firebase

### 1. مجموعة المدارس (schools)
```json
{
  "id": "school_id",
  "name": "اسم المدرسة",
  "logo": "base64_encoded_image",
  "location": "موقع المدرسة",
  "adminUsername": "اسم المستخدم",
  "adminPassword": "كلمة المرور",
  "range": 100.0,
  "delayMinutes": 15,
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

### 2. مجموعة الفصول (class_sections)
```json
{
  "id": "class_id",
  "schoolId": "school_id",
  "name": "KG2 A",
  "description": "وصف الفصل",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

### 3. مجموعة الطلاب (students)
```json
{
  "id": "student_id",
  "schoolId": "school_id",
  "idNumber": "1234567890",
  "name": "أحمد محمد علي",
  "classSection": "KG2 A",
  "guardianName": "محمد علي",
  "guardianPhone": "01012345678",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

### 4. مجموعة المنسوبين (staff)
```json
{
  "id": "staff_id",
  "schoolId": "school_id",
  "name": "فاطمة أحمد",
  "email": "fatima@school.com",
  "phone": "01012345678",
  "role": "teacher",
  "username": "fatima_teacher",
  "password": "password123",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

## 🔧 استكشاف الأخطاء

### 1. خطأ "Firebase not initialized"
- تأكد من تحديث `firebase_options.dart`
- تأكد من تشغيل `flutter pub get`

### 2. خطأ "Permission denied"
- تحقق من قواعد الأمان في Firestore
- تأكد من تفعيل Authentication

### 3. خطأ "Network error"
- تحقق من اتصال الإنترنت
- تأكد من إعدادات الشبكة

### 4. لا تظهر البيانات
- تحقق من Console للأخطاء
- تأكد من حفظ البيانات في Firebase
- تحقق من قواعد الأمان

## 📱 اختبار على الأجهزة

### 1. اختبار على الهاتف
```bash
flutter run -d android
# أو
flutter run -d ios
```

### 2. اختبار على الويب
```bash
flutter run -d chrome
```

## 🚀 النشر

### 1. بناء التطبيق للإنتاج
```bash
flutter build web
```

### 2. رفع على Firebase Hosting
```bash
firebase deploy
```

---

**النظام جاهز للاستخدام مع Firebase! 🎉**

جميع البيانات مربوطة 100% مع Firebase Firestore وستظهر في الوقت الفعلي.
